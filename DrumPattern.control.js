
/*
 * Drum Pattern
 * controller script for Bitwig Studio
 * Converts stored drum patterns into MIDI (GM drum map)
 * @version 0.1
 */
loadAPI(17)

host.setShouldFailOnDeprecatedUse(true)
host.defineController('1legality', 'Drum Pattern', '0.1', '5f9c773d-8d93-4d72-a27f-f583efad6b1f', '1legality')

const STEP_LENGTH_BEATS = 0.25
const DEFAULT_VELOCITY = 110
const DEFAULT_TRANSPOSE = -30 // Shift down ~2.5 octaves to land kicks around C1

const GM_DRUM_MAP = {
  "BD": 36,
  "SN": 38,
  "CH": 42,
  "OH": 46,
  "LT": 45,
  "MT": 47,
  "HT": 50,
  "CL": 39,
  "SH": 70,
  "RS": 37,
  "CB": 56,
  "CY": 49,
  "HC": 63,
  "AC": 57,
  "LC": 64
}

const DRUM_SECTIONS = ["Afro-Cuban","Basic Patterns","Breaks","Breaks - Kick","Breaks - Snare","Drum Rolls","Drum and Bass","Dub","EDM","Electro","Funk and Soul","Ghost Snares","Hip Hop","House","Hybrid Breaks With Alternate Endings","Irregular Breaks","Miami Bass","Pop","Reggaeton","Rock","Rolling Breaks","Standard Breaks","Uncategorized"];
const DRUM_PATTERNS = [{"s":22,"n":"EXAMPLE PATTERN","i":{"BD":[1,9],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":1,"n":"ONE AND SEVEN & FIVE AND THIRTEEN","i":{"BD":[1,7],"SN":[5,13]}},{"s":1,"n":"BOOTS N\u2019 CATS","i":{"BD":[1,9],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":1,"n":"TINY HOUSE","i":{"OH":[3,7,11,15],"BD":[1,5,9,13]}},{"s":1,"n":"GOOD TO GO","i":{"BD":[1,4,7,11],"SN":[5,13]}},{"s":1,"n":"HIP HOP","i":{"BD":[1,3,7,8,15],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":21,"n":"STANDARD BREAK 1","i":{"BD":[1,11],"SN":[5,13],"CH":[1,3,5,7,9,10,11,13,15]}},{"s":21,"n":"STANDARD BREAK 2","i":{"BD":[1,11],"SN":[5,13],"CH":[1,3,5,7,8,9,11,15]}},{"s":21,"n":"ROLLING BREAK","i":{"BD":[1,8,11],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":21,"n":"THE UNKNOWN DRUMMER","i":{"BD":[1,4,7,11],"SN":[2,5,8,13],"CH":[2,3,5,6,8,14],"OH":[9,15]}},{"s":19,"n":"ROCK 1","i":{"BD":[1,8,9,11],"SN":[5,13],"CY":[1],"CH":[1,3,5,7,9,11,13,15]}},{"s":19,"n":"ROCK 2","i":{"BD":[1,8,9,11],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":19,"n":"ROCK 3","i":{"BD":[1,8,9,11],"SN":[5,13],"OH":[15],"CH":[1,3,5,7,9,11,13,15]}},{"s":19,"n":"ROCK 4","i":{"BD":[1,8,9,11],"SN":[5,13,15,16],"OH":[15],"CH":[1,3,5,7,9,11,13,15]}},{"s":9,"n":"ELECTRO 1 - A","i":{"SN":[5,13],"BD":[1,7]}},{"s":9,"n":"ELECTRO 1 - B","i":{"SN":[5,13],"BD":[1,7,11,15]}},{"s":9,"n":"ELECTRO 2 - A","i":{"SN":[5,13],"BD":[1,7]}},{"s":9,"n":"ELECTRO 2 - B","i":{"SN":[5,13],"BD":[1,11,14]}},{"s":9,"n":"ELECTRO 3 - A","i":{"SN":[5,13],"BD":[1,7,12]}},{"s":9,"n":"ELECTRO 3 - B","i":{"SN":[5,13],"BD":[1,7,12,14]}},{"s":9,"n":"ELECTRO 4","i":{"SN":[5,13],"BD":[1,7,11,14]}},{"s":9,"n":"SIBERIAN NIGHTS","i":{"CH":[1,3,4,5,7,8,9,11,12,13,15,16],"SN":[5,13],"BD":[1,7]}},{"s":9,"n":"NEW WAVE","i":{"BD":[1,7,9,10],"SN":[5,13],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[3],"SH":[5,13]}},{"s":13,"n":"HOUSE","i":{"BD":[1,5,9,13],"SN":[5,13],"CY":[1],"OH":[3,7,11,15]}},{"s":13,"n":"HOUSE 2","i":{"BD":[1,5,9,13],"SN":[5,13],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[3,6,11,14]}},{"s":13,"n":"BRIT HOUSE","i":{"BD":[1,5,9,13],"CL":[5,13],"CY":[3,7,11,15],"CH":[1,2,4,5,6,8,9,10,12,13,14,16],"OH":[3,7,11,15]}},{"s":13,"n":"FRENCH HOUSE","i":{"BD":[1,5,9,13],"CL":[5,13],"SH":[1,2,3,5,7,8,9,10,11,13,15,16],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[2,4,6,8,10,12,14,16]}},{"s":13,"n":"DIRTY HOUSE","i":{"BD":[1,3,5,9,11,13,16],"SN":[5,13],"CL":[3,5,9,11,13],"CH":[11,16],"OH":[3,11,15]}},{"s":13,"n":"DEEP HOUSE","i":{"BD":[1,5,9,13],"CL":[5,13],"CH":[2,8,10],"OH":[3,7,11,15]}},{"s":13,"n":"DEEPER HOUSE","i":{"BD":[1,5,9,13],"CL":[2,10],"MT":[3,8,11],"SH":[4,9],"OH":[3,7,11,12,15]}},{"s":13,"n":"SLOW DEEP HOUSE","i":{"BD":[1,5,9,13],"CL":[5,13],"SH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"CH":[1,5,9,13],"OH":[3,4,7,8,10,11,13]}},{"s":13,"n":"FOOTWORK - A","i":{"BD":[1,4,7,9,12,15],"CL":[13],"CH":[3,11],"RS":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}},{"s":13,"n":"FOOTWORK - B","i":{"BD":[1,4,7,9,12,15],"CL":[13],"CH":[3,7,8,11,15],"RS":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}},{"s":16,"n":"MIAMI BASS - A","i":{"BD":[1,7],"SN":[5,13],"CH":[1,3,4,5,7,8,9,11,12,13,15,16]}},{"s":16,"n":"MIAMI BASS - B","i":{"BD":[1,7,11,14],"SN":[5,13],"CH":[1,3,4,5,7,8,9,11,12,13,15,16]}},{"s":16,"n":"SALLY","i":{"BD":[1,7,11,15],"SN":[5,13],"LT":[1,7,11,15],"CH":[1,3,5,7,9,11,13,15]}},{"s":16,"n":"ROCK THE PLANET","i":{"BD":[1,4,7],"SN":[5,13],"CH":[1,3,4,5,7,8,9,11,12,13,14,15,16]}},{"s":12,"n":"HIP HOP 1 - A","i":{"BD":[1,7,8,12,15],"SN":[5,13]}},{"s":12,"n":"HIP HOP 1 - B","i":{"BD":[1,8,12],"SN":[5,13]}},{"s":12,"n":"HIP HOP 2 - A","i":{"BD":[1,8,9,10,14,16],"SN":[5,13]}},{"s":12,"n":"HIP HOP 2 - B","i":{"BD":[1,8,9,12],"SN":[5,10,13]}},{"s":12,"n":"HIP HOP 3 - A","i":{"BD":[1,3,9,11],"SN":[5,13]}},{"s":12,"n":"HIP HOP 3 - B","i":{"BD":[1,3,9,10,12],"SN":[5,13]}},{"s":12,"n":"HIP HOP 4 - A","i":{"BD":[1,4,8,10,11,16],"SN":[5,13]}},{"s":12,"n":"HIP HOP 4 - B","i":{"BD":[1,3,8,9,10,11],"SN":[5,13]}},{"s":12,"n":"HIP HOP 5","i":{"BD":[1,3,8,9,11,16],"SN":[5,13]}},{"s":12,"n":"HIP HOP 6","i":{"BD":[1,3,11,12,16],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":12,"n":"HIP HOP 7","i":{"BD":[1,8,11,14,16],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":12,"n":"HIP HOP 8","i":{"BD":[1,4,9,11,12],"SN":[5,13],"CH":[1,2,4,5,7,8,9,10,12,13,15,16],"OH":[6,14]}},{"s":12,"n":"TRAP - A","i":{"BD":[1,7,13],"SN":[9],"CH":[1,3,5,7,9,11,13,15]}},{"s":12,"n":"TRAP - B","i":{"BD":[3,5],"SN":[9],"CH":[3,5,7,9,11,15]}},{"s":12,"n":"PLANET ROCK - A","i":{"CH":[1,3,4,5,7,8,9,11,12,13,14,15,16],"CB":[1,3,5,7,8,10,12,13,15],"SN":[5,13],"BD":[1,7],"HC":[5,13]}},{"s":12,"n":"PLANET ROCK - B","i":{"CH":[1,3,4,5,7,8,9,11,12,13,14,15,16],"CB":[1,3,5,7,8,10,12,13,15],"SN":[5,13],"BD":[1,7,11,14],"HC":[5,13]}},{"s":12,"n":"INNA CLUB","i":{"OH":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[3,8,11,16],"HC":[5,13]}},{"s":12,"n":"ICE","i":{"SN":[5,13],"BD":[1,7,11,15],"SH":[1,3,5,7,9,11,13,15]}},{"s":12,"n":"BACK TO CALI - A","i":{"CH":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,7],"HC":[5,7,9,13,15]}},{"s":12,"n":"BACK TO CALI - B","i":{"CH":[1,3,5,7,9,11,15],"OH":[13],"SN":[5,13],"BD":[1,7,11,14],"HC":[1,5,7,9,13]}},{"s":12,"n":"SNOOP STYLES","i":{"RS":[3,6,9,12],"OH":[1,4,7,11],"SN":[5,13],"BD":[1,4,7,11],"HC":[5,13]}},{"s":12,"n":"THE GROOVE - A","i":{"CH":[1,3,5,7,9,11,13,15],"OH":[8],"SN":[5,13],"BD":[1,4,8,12,15],"SH":[5,13]}},{"s":12,"n":"THE GROOVE - B","i":{"CH":[1,3,5,7,9,11,13,14],"OH":[8,11,12,13,15],"SN":[5,13],"HT":[10,11],"MT":[12,14],"LT":[15,16],"BD":[1,4,8,12],"SH":[5,13]}},{"s":12,"n":"BOOM BAP","i":{"CB":[9],"OH":[15],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"CL":[3,7,11,15],"SN":[3,7,11,15],"BD":[1,3,6,10,14]}},{"s":12,"n":"MOST WANTED - A","i":{"CH":[1,3,5,7,9,11,13,15],"CY":[1],"SN":[5,13],"BD":[1,7,9,10,16],"HC":[5,13]}},{"s":12,"n":"MOST WANTED - B","i":{"CH":[1,5,7,9,11,13,15],"OH":[3],"SN":[5,13],"BD":[3,7,9,10],"HC":[5,13]}},{"s":10,"n":"AMEN BREAK - A","i":{"BD":[1,3,11,12],"SN":[5,8,10,13,16],"CH":[1,3,5,7,9,11,13,15]}},{"s":10,"n":"AMEN BREAK - B","i":{"BD":[1,3,11,12],"SN":[8,10,13,16],"CH":[1,3,5,7,9,11,13,15],"RS":[5]}},{"s":10,"n":"AMEN BREAK - C","i":{"BD":[1,3,11],"SN":[8,10,13,16],"CH":[1,3,5,7,9,11,13,15],"RS":[15]}},{"s":10,"n":"AMEN BREAK - D","i":{"BD":[1,3,11],"SN":[2,5,8,10,15],"CH":[1,3,5,7,9,13,15],"CY":[11]}},{"s":10,"n":"THE FUNKY DRUMMER","i":{"BD":[1,3,7,11,14],"SN":[5,8,10,12,13,16],"CH":[1,2,3,4,5,6,7,9,10,11,12,13,15,16],"OH":[8,14]}},{"s":10,"n":"IMPEACH THE PRESIDENT","i":{"BD":[1,8,9,15],"SN":[5,13],"CH":[1,3,5,7,8,9,13,15],"OH":[11]}},{"s":10,"n":"WHEN THE LEVEE BREAKS","i":{"BD":[1,2,8,11,12],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":10,"n":"IT\u2019S A NEW DAY","i":{"BD":[1,3,11,12,16],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":10,"n":"THE BIG BEAT","i":{"BD":[1,4,7,9],"SN":[5,13],"CH":[5,13]}},{"s":10,"n":"ASHLEY\u2019S ROACHCLIP","i":{"BD":[1,3,7,9,10],"SN":[5,13],"CH":[1,3,5,7,9,13,15],"OH":[11],"CB":[1,3,5,7,9,11,13,15]}},{"s":10,"n":"PAPA WAS TOO","i":{"BD":[1,8,9,11,16],"SN":[5,13],"CH":[5,9,11,13,15,16],"CY":[5]}},{"s":10,"n":"SUPERSTITION","i":{"BD":[1,5,9,13],"SN":[5,13],"CH":[1,3,5,7,8,9,10,11,13,15,16]}},{"s":10,"n":"CISSY STRUT - A","i":{"BD":[1,4,6,10,12,13,15],"SN":[5,8,10,11],"CY":[13,15]}},{"s":10,"n":"CISSY STRUT - B","i":{"BD":[1,4,8,10,12,13,15],"SN":[3,6,7,9,10]}},{"s":10,"n":"CISSY STRUT - C","i":{"BD":[1,5,8,10,12,13,15],"SN":[3,5,6,7,10],"CY":[13,15]}},{"s":10,"n":"CISSY STRUT - D","i":{"BD":[1,5,8,10,12,13,15],"SN":[1,3,6,9,10],"CY":[13,15]}},{"s":10,"n":"HOOK AND SLING - A","i":{"BD":[1,3,10,14,15],"SN":[5,7,8,11,13],"CY":[1,3,4,6,9,10,12,15]}},{"s":10,"n":"HOOK AND SLING - B","i":{"BD":[15],"SN":[1,5,6,8,11,12,15,16],"CY":[1,2,4,7,9,10,13,15]}},{"s":10,"n":"HOOK AND SLING - C","i":{"BD":[1,2,13,14,16],"SN":[3,5,7,8,11,12,15],"CY":[1,3,5,6,8,10,13,14]}},{"s":10,"n":"HOOK AND SLING - D","i":{"BD":[1,3,6,12,14,15],"SN":[5,8,11,16],"CY":[1,3,5,6,8]}},{"s":10,"n":"KISSING MY LOVE - A","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"SN":[5,8,10,13],"BD":[1,2,4,12,15]}},{"s":10,"n":"KISSING MY LOVE - B","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"SN":[5,8,10,13,16],"BD":[1,2,4,12,14]}},{"s":10,"n":"KISSING MY LOVE - C","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"SN":[5,8,10,16],"BD":[1,2,4,11,13,14]}},{"s":10,"n":"KISSING MY LOVE - D","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"SN":[5,10,13],"BD":[1,4,12,15]}},{"s":10,"n":"KISSING MY LOVE - E","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15],"SN":[5,8,10,13],"BD":[1,12,14]}},{"s":10,"n":"LADY - A","i":{"CY":[3,7],"SN":[5,6],"BD":[1,9,12,15]}},{"s":10,"n":"LADY - B","i":{"CY":[3,7],"SN":[5,6,9],"BD":[1,12,15]}},{"s":10,"n":"KNOCKS ME OFF MY FEET - A","i":{"CY":[1,3,7,8,10,11,15],"SN":[5,13],"BD":[1,3,5,8,9,11,13,16]}},{"s":10,"n":"KNOCKS ME OFF MY FEET - B","i":{"CY":[1,3,7,8,10,11,15],"SN":[5,13],"BD":[1,3,5,8,9,11,13,16]}},{"s":10,"n":"THE THRILL IS GONE","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[1,5,9,13],"BD":[8,9,11]}},{"s":10,"n":"POP TECH - A","i":{"CY":[1,9],"SN":[5,13],"BD":[1]}},{"s":10,"n":"POP TECH - B","i":{"CY":[1,9],"SN":[5,13],"BD":[2,14,15,16]}},{"s":10,"n":"YA MAMA - A","i":{"CY":[5,13],"BD":[1,9]}},{"s":10,"n":"YA MAMA - B","i":{"CY":[5,13],"BD":[1,8,9]}},{"s":10,"n":"COLD SWEAT - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,8,15],"BD":[1,9,11]}},{"s":10,"n":"COLD SWEAT - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,5,8,10,13],"BD":[3,9,11,15]}},{"s":10,"n":"I GOT YOU (I FEEL GOOD) - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,11]}},{"s":10,"n":"I GOT YOU (I FEEL GOOD) - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[3,7,11,15]}},{"s":10,"n":"THE SAME BLOOD","i":{"CY":[1,3,5,7,8,9,11,12,13,15,16],"SN":[4,6,7,13,14,15],"BD":[1,2,9,10]}},{"s":10,"n":"GROOVE ME","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,4,5,8,9,10,12,14,16]}},{"s":10,"n":"LOOK-KA PY PY - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,5,8,9,11,15],"BD":[1,4,6,11,14,15]}},{"s":10,"n":"LOOK-KA PY PY - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,5,6,8,9,11,15],"BD":[1,4,6,8,9,11,14,15]}},{"s":10,"n":"USE ME - A","i":{"CY":[1,3,5,6,7,8,9,10,11,13,14,15,16],"SN":[3,5,7,8,10,11,13,15,16],"BD":[1,5,13]}},{"s":10,"n":"USE ME - B","i":{"CY":[1,2,3,5,6,7,8,9,10,11,13,14,15,16],"SN":[2,3,5,7,8,10,11,13,15,16],"BD":[5,8,11,13]}},{"s":10,"n":"USE ME - C","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"SN":[5,8,10,13,16],"BD":[1,3,6,8,9,11,12,14,16]}},{"s":10,"n":"USE ME - D","i":{"CY":[1,2,3,4,5,6,7,8,9,10,12,14,16],"SN":[5,8,16],"BD":[1,3,6,9,10,12,14,16]}},{"s":10,"n":"FUNKY PRESIDENT","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,4,8,10,11]}},{"s":10,"n":"GET UP - A","i":{"CY":[1,3,5,7,8,9,11,13,15,16],"SN":[5,7,8,10,13,16],"BD":[1,11,15]}},{"s":10,"n":"GET UP - B","i":{"CY":[1,3,5,7,8,9,11,13,15],"SN":[5,7,8,10,13,16],"BD":[1,11,15]}},{"s":10,"n":"EXPENSIVE SHIT","i":{"CY":[1,3,4,5,7,8,9,11,12,13,15,16],"SN":[1,2,4,6,9,10,13,14],"BD":[4,7,15]}},{"s":10,"n":"CHUG CHUG CHUG-A-LUG","i":{"CY":[1,3,5,6,7,9,10,11,13,15],"SN":[2,3,5,8,10,11,13],"BD":[1,4,6,8,10,12,15]}},{"s":10,"n":"THE FEZ - A","i":{"CY":[3,7,11,15],"SN":[2,4,5,6,8,10,12,13,14,16],"BD":[1,9]}},{"s":10,"n":"THE FEZ - B","i":{"CY":[3,7,11,15],"SN":[2,4,5,6,8,10,12,13,14,16],"BD":[1,9,12,15]}},{"s":10,"n":"ROCK STEADY","i":{"CY":[1,3,5,7,8,9,11,13,15,16],"SN":[2,5,6,8,10,13,14,16],"BD":[3,5,8,11,13]}},{"s":10,"n":"SYNTHETIC SUBSTITUTION - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,9],"BD":[1,3,8,10,11,12,16]}},{"s":10,"n":"SYNTHETIC SUBSTITUTION - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,9],"BD":[1,3,8,10,11,12,16]}},{"s":10,"n":"COW\u2019D BELL - A","i":{"CB":[1,3,4,5,7,8,9,11,12,13,15,16],"SN":[2,4,5,6,8,10,12,13,14,16],"BD":[1,4,7,8,11,12,14,16]}},{"s":10,"n":"COW\u2019D BELL - B","i":{"CB":[1,3,4,5,7,8,9,11,12,13,15,16],"SN":[2,4,5,6,8,10,12,13,14,16],"BD":[1,3,4,8,9,11,12,14,16]}},{"s":10,"n":"PALM GREASE - A","i":{"CY":[1,2,3,4,6,7,9,11,12,14,15],"SN":[5,8,10,13,16],"BD":[1,9,16]}},{"s":10,"n":"PALM GREASE - B","i":{"CY":[1,3,11],"SN":[2,6,15],"BD":[3]}},{"s":10,"n":"O-O-H CHILD - A","i":{"CY":[1,2,3,5,6,7,9,10,11,13,14,15],"SN":[2,4,5,7,8,10,12,13,14,16],"BD":[1,3,9,11,12]}},{"s":10,"n":"^      ^      ^      ^","i":{"CY":[1,2,3,5,6,7,9,10,11,13,14,15],"SN":[2,4,5,7,8,10,13,15],"BD":[1,3,9,11,12]}},{"s":10,"n":"LADY MARMALADE - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,3,7,9,15]}},{"s":10,"n":"LADY MARMALADE - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,9],"BD":[13]}},{"s":10,"n":"HOT SWEAT - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,8,9,10,13,15,16],"BD":[1,11]}},{"s":10,"n":"HOT SWEAT - B","i":{"CY":[1,3,4,5,7,9,11,12,13,15],"SN":[2,4,5,6,8,10,12,13,14],"BD":[3,4,11,12,15]}},{"s":10,"n":"HAITIAN DIVORCE","i":{"CY":[1,2,3,5,6,7,8,9,10,11,13,14,15,16],"SN":[2,5,7,8,10,13,15,16],"BD":[3,5,11,13]}},{"s":10,"n":"COME DANCING - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,3,5,6,7,10,11,13,14,15],"BD":[1,8,9,16]}},{"s":10,"n":"COME DANCING - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,5,6,10,13,14,15],"BD":[1,3,6,8,9,16]}},{"s":10,"n":"RESPECT YOURSELF - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,11,13],"BD":[1,5,9,13]}},{"s":10,"n":"RESPECT YOURSELF - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,9,11,13],"BD":[1,5,9,13]}},{"s":10,"n":"EXPRESS YOURSELF - A","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"SN":[5,8,10,12,14,16],"BD":[1,4,9,12,15]}},{"s":10,"n":"EXPRESS YOURSELF - B","i":{"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"SN":[5,8,10,12,13],"BD":[1,4,9,12,15]}},{"s":10,"n":"LET A WOMAN BE A WOMAN","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,8,10,11,13,14],"BD":[3,9,11,12,14,15]}},{"s":10,"n":"LET A MAN BE A MAN","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,8,10,12,13],"BD":[3,11,15]}},{"s":10,"n":"BOOKS OF MOSES - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,5,9,12]}},{"s":10,"n":"BOOKS OF MOSES - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[5,13],"BD":[1,5,9]}},{"s":10,"n":"MOTHER POPCORN - A","i":{"CY":[1,5,9,13],"SN":[5,8,10,15],"BD":[1,3,11]}},{"s":10,"n":"MOTHER POPCORN - B","i":{"CY":[1,5,9,13],"SN":[2,4,5,6,8,10,12,13,14,16],"BD":[3,7,11,15]}},{"s":10,"n":"STRT BTS - A","i":{"CY":[2,3,5,6,8,9,14,15],"SN":[2,5,8,12,13],"BD":[1,4,7,11]}},{"s":10,"n":"STRT BTS - B","i":{"CY":[2,3,5,6,8,9,14,15],"SN":[2,5,8,13],"BD":[1,4,7,11]}},{"s":10,"n":"I GOT THE FEELIN\u2019 - A","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[7,10,15],"BD":[1,3,11]}},{"s":10,"n":"I GOT THE FEELIN\u2019 - B","i":{"CY":[1,3,5,7,9,11,13,15],"SN":[2,5,6,8,10,11,12,14,15,16],"BD":[3,9,13,15]}},{"s":10,"n":"MORE BOUNCE TO THE OUNCE","i":{"CH":[3,5,7,9,11,13,15],"OH":[1],"HC":[5,13],"SN":[5,13],"BD":[1,9,10]}},{"s":0,"n":"SON CLAVE","i":{"BD":[1,4,5,8,9,12,13,16],"RS":[1,4,7,11,13],"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}},{"s":0,"n":"RUMBA","i":{"BD":[1,4,5,8,9,12,13,16],"RS":[1,4,8,11,13],"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}},{"s":0,"n":"BOSSA NOVA","i":{"BD":[1,4,5,8,9,12,13,16],"RS":[1,4,7,11,14],"CY":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16]}},{"s":0,"n":"BOUTON","i":{"BD":[1,9,11,15],"RS":[4,7,13],"CH":[1,3,4,5,7,9,11,13,15]}},{"s":0,"n":"GAHU","i":{"BD":[1,5,9,13,15],"RS":[3,4,7,8,11,12,15,16],"CB":[1,4,7,11,15]}},{"s":0,"n":"SHIKO","i":{"BD":[1,5,7,9,13,15],"RS":[3,4,7,8,11,12,15,16],"CB":[1,5,7,11,13]}},{"s":0,"n":"SOUKOUS","i":{"BD":[1,5,9,13,15],"RS":[1,4,7,9,12,15],"CB":[1,4,7,10,11]}},{"s":6,"n":"DRUM AND BASS 1 - A","i":{"BD":[1,4,8,10,11,16],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":6,"n":"DRUM AND BASS 1 - B","i":{"BD":[1,3,8,9,10,11],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":6,"n":"DRUM AND BASS 2 - A","i":{"BD":[1,8,10,12,16],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":6,"n":"DRUM AND BASS 2 - B","i":{"BD":[1,12],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15,16]}},{"s":6,"n":"DRUM AND BASS 3","i":{"BD":[1,11],"SN":[5,13],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[7,8,9,10]}},{"s":6,"n":"DRUM AND BASS 4 - A","i":{"BD":[1,7],"SN":[5,11,13],"CH":[1,3,5,7,9,11,13,15],"OH":[1]}},{"s":6,"n":"DRUM AND BASS 4 - B","i":{"BD":[5,11],"SN":[5,13],"CH":[1,3,5,7,9,11,13,15]}},{"s":6,"n":"JUNGLE - A","i":{"BD":[1,3,11],"SN":[5,8,10,15],"CH":[1,3,5,7,9,11,13,15],"OH":[1]}},{"s":6,"n":"JUNGLE - B","i":{"BD":[2,3,11],"SN":[2,5,8,10,15],"CH":[1,3,5,7,9,11,13,15]}},{"s":8,"n":"TECHNO","i":{"BD":[1,5,9,13,15],"SN":[5,13],"CH":[10],"OH":[3,7,11,15]}},{"s":8,"n":"DUBSTEP - A","i":{"BD":[1,11],"SN":[9],"CH":[2,3,7,12,15],"OH":[5,14]}},{"s":8,"n":"DUBSTEP - B","i":{"BD":[1,4,7,11],"SN":[9],"CH":[2,3,7,12,15],"OH":[5,14]}},{"s":8,"n":"DUBSTEP - RATCHETED","i":{"BD":[1,4,9,12],"SN":[5,13,16],"CH":[1,2,6,7,8,9,10,12,13,14,16],"OH":[7]}},{"s":8,"n":"UK GARAGE - A","i":{"BD":[1,11],"CL":[5,13],"CH":[3,4,7,11,15,16],"RS":[2,8,14],"MT":[6,12]}},{"s":8,"n":"UK GARAGE - B","i":{"BD":[1,11],"CL":[5,13],"CH":[3,7,11,15],"RS":[8,14],"MT":[6,12]}},{"s":8,"n":"SYNTH WAVE","i":{"BD":[1,9],"SN":[5,13],"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[14]}},{"s":7,"n":"HALF DROP","i":{"BD":[1],"SN":[9],"CH":[1,3,5,7,9,11,13,15]}},{"s":7,"n":"ONE DROP","i":{"BD":[9],"SN":[9],"CH":[1,3,5,7,9,11,13,15]}},{"s":7,"n":"TWO DROP","i":{"BD":[1,9],"SN":[9],"CH":[1,3,5,7,9,11,13,15]}},{"s":7,"n":"STEPPERS","i":{"BD":[1,5,9,13],"SN":[9],"CH":[1,3,5,7,9,11,13,15]}},{"s":18,"n":"REGGAETON 1","i":{"BD":[1,5,9,13],"SN":[4,7,12,15],"CH":[1,3,5,7,9,11,13,15]}},{"s":18,"n":"REGGAETON 2","i":{"CH":[3,7,11,15],"SN":[4,6,7,8,11,12,15],"BD":[1,8]}},{"s":18,"n":"REGGAETON 3 - A","i":{"SN":[1,4,7,9,12,15],"BD":[1,9]}},{"s":18,"n":"REGGAETON 3 - B","i":{"CH":[1,4,7,9,12,15],"SN":[1,4,7,9,12,15],"BD":[1,9]}},{"s":17,"n":"POP 1 - A","i":{"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[1,4,7,9,10],"RS":[1,2,4,7,8,11,12],"SN":[5,13],"BD":[1,2,4,8,11],"HC":[5,13]}},{"s":17,"n":"IN THE AIR LAST NIGHT - A","i":{"HT":[3,7],"OH":[1,13],"CH":[3,7,11,13],"SN":[13],"BD":[11]}},{"s":17,"n":"IN THE AIR LAST NIGHT - B","i":{"HT":[3,7],"OH":[1,13],"CH":[3,7,11,13],"SN":[13],"BD":[1,3,5,7,9,11,15]}},{"s":17,"n":"NINETEEN - A","i":{"CH":[1,4,7,9,10],"OH":[1,4,7,9,10],"RS":[1,2,4,7,8,11,12],"BD":[1,2,4,8,11],"HC":[5,13]}},{"s":17,"n":"NINETEEN - B","i":{"CH":[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16],"OH":[1,4,7,9,10],"RS":[1,2,4,7,8,11,12],"SN":[5,13],"BD":[1,2,4,8,11],"HC":[5,13]}},{"s":17,"n":"BLEU MONDAY - A","i":{"OH":[3,7,11,15],"SN":[5,13],"BD":[1,9],"HC":[5,13]}},{"s":17,"n":"BLEU MONDAY - B","i":{"CH":[1,4,5,8,9,12,13,16],"OH":[3,7,11,15],"SN":[5,13],"BD":[1,9],"HC":[5,13]}},{"s":2,"n":"STANDARD BREAKBEAT 1","i":{"BD":[1,11],"SN":[5,13]}},{"s":2,"n":"STANDARD BREAKBEAT 2","i":{"BD":[1,3,11],"SN":[5,13]}},{"s":2,"n":"STANDARD BREAKBEAT 3","i":{"BD":[1,3,7,11],"SN":[5,8,10,13]}},{"s":2,"n":"POLYRHYTHMIC - A","i":{"BD":[1,7],"SN":[3,5,9,11,12,13,15,16]}},{"s":2,"n":"POLYRHYTHMIC - B","i":{"BD":[3,9],"SN":[5,7,11,13]}},{"s":14,"n":"HYBRID KICK","i":{"BD":[1,9],"SN":[5,13]}},{"s":14,"n":"\u21b3 FOLLOW WITH HYBRID BREAK ENDING 1","i":{"BD":[1,11],"SN":[5,10,13]}},{"s":14,"n":"\u21b3 OR FOLLOW WITH HYBRID BREAK ENDING 2","i":{"BD":[1,7,9,12],"SN":[5,13]}},{"s":14,"n":"\u21b3 OR FOLLOW WITH HYBRID BREAK ENDING 3","i":{"BD":[1,8,11],"SN":[5,13]}},{"s":14,"n":"\u21b3 OR FOLLOW WITH HYBRID BREAK ENDING 4","i":{"BD":[1,10],"SN":[5,13]}},{"s":14,"n":"\u21b3 OR FOLLOW WITH HYBRID BREAK ENDING 5","i":{"BD":[1,3,9,11],"SN":[5,13]}},{"s":14,"n":"\u21b3 OR FOLLOW WITH HYBRID BREAK ENDING 6","i":{"BD":[1,6,8,10,11],"SN":[5,13]}},{"s":14,"n":"HYBRID KICK 7 - A","i":{"BD":[1,3,9,11],"SN":[5,13]}},{"s":14,"n":"\u21b3 FOLLOW WITH HYBRID BREAK 7 - B","i":{"BD":[1,2,9,11],"SN":[5,13]}},{"s":14,"n":"HYBRID 8 - A","i":{"BD":[1,9,11],"SN":[5,13]}},{"s":14,"n":"\u21b3 FOLLOW WITH HYBRID BREAK 8 - B","i":{"BD":[1,2,9,11],"SN":[5,13]}},{"s":15,"n":"IRREGULAR 1 - A","i":{"BD":[1,3,4,7,11],"SN":[5,8,13,16]}},{"s":15,"n":"IRREGULAR 1 - B","i":{"BD":[1,3,8,11],"SN":[5,13,16]}},{"s":15,"n":"IRREGULAR 2 - A","i":{"BD":[1,8,11],"SN":[4,13]}},{"s":15,"n":"IRREGULAR 2 - B","i":{"BD":[1,3,7,11],"SN":[5,9,13]}},{"s":15,"n":"IRREGULAR 3","i":{"BD":[1,4,9,15],"SN":[2,5,11,14]}},{"s":20,"n":"ROLLING 1","i":{"BD":[1,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 2","i":{"BD":[1,11,14],"SN":[5,13]}},{"s":20,"n":"ROLLING 3 - A","i":{"BD":[1,7,13],"SN":[5,11]}},{"s":20,"n":"ROLLING 3 - B","i":{"BD":[1,7,13],"SN":[5,11,15]}},{"s":20,"n":"ROLLING 4 - A","i":{"BD":[1,2],"SN":[5,13]}},{"s":20,"n":"ROLLING 4 - B","i":{"BD":[1,8,10,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 5 - A","i":{"BD":[1,3,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 5 - B","i":{"BD":[1,4,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 6 - A","i":{"BD":[1,7,12],"SN":[5,13]}},{"s":20,"n":"ROLLING 6 - B","i":{"BD":[1,3,8,11,14],"SN":[5,13]}},{"s":20,"n":"ROLLING 7 - A","i":{"BD":[1,8,9,12],"SN":[5,13]}},{"s":20,"n":"ROLLING 7 - B","i":{"BD":[1,4,8,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 7 - C","i":{"BD":[1,8,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 7 - D","i":{"BD":[1,4,8,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 8","i":{"BD":[1,8],"SN":[5,13]}},{"s":20,"n":"ROLLING 9 - A","i":{"BD":[1,9,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 9 - B","i":{"BD":[1,2,9,11],"SN":[5,13]}},{"s":20,"n":"ROLLING 10","i":{"BD":[1,8,12],"SN":[5,13]}},{"s":20,"n":"ROLLING 11","i":{"BD":[1,6,7,10,11],"SN":[5,13]}},{"s":4,"n":"CONTEMPORARY SNARE 1 - A","i":{"BD":[1,11],"SN":[5,10,15]}},{"s":4,"n":"CONTEMPORARY SNARE 1 - B","i":{"BD":[3,11],"SN":[7,10,13]}},{"s":4,"n":"CONTEMPORARY SNARE 2 - A","i":{"BD":[1,3,11],"SN":[5,13]}},{"s":4,"n":"CONTEMPORARY SNARE 2 - B","i":{"BD":[3,11,12],"SN":[5,10,13]}},{"s":4,"n":"CONTEMPORARY SNARE 3 - A","i":{"BD":[1,7,15],"SN":[5,11,14,16]}},{"s":4,"n":"CONTEMPORARY SNARE 3 - B","i":{"BD":[1,4,7,15],"SN":[5,11]}},{"s":4,"n":"UNCONVENTIONAL SNARE 1 - A","i":{"BD":[1,5,11],"SN":[9,15]}},{"s":4,"n":"UNCONVENTIONAL SNARE 1 - B","i":{"BD":[1,7,11],"SN":[5,13]}},{"s":4,"n":"UNCONVENTIONAL SNARE 2 - A","i":{"BD":[1,13],"SN":[5,9,12]}},{"s":4,"n":"UNCONVENTIONAL SNARE 2 - B","i":{"BD":[1,5,9,11],"SN":[8,13]}},{"s":4,"n":"UNCONVENTIONAL SNARE 3 - A","i":{"BD":[1,7,14],"SN":[5,11]}},{"s":4,"n":"UNCONVENTIONAL SNARE 3 - B","i":{"BD":[1,5,9,11],"SN":[8,13]}},{"s":4,"n":"UNCONVENTIONAL SNARE 4 - A","i":{"BD":[1,3,7,9],"SN":[5,11]}},{"s":4,"n":"UNCONVENTIONAL SNARE 4 - B","i":{"BD":[3,11],"SN":[1,5,10,13]}},{"s":11,"n":"GHOST SNARE 1 - A","i":{"SN":[5,8,10,13,16]}},{"s":11,"n":"GHOST SNARE 1 - B","i":{"SN":[5,8,10,13]}},{"s":11,"n":"GHOST SNARE 2 - A","i":{"SN":[2,5,8,13,16]}},{"s":11,"n":"GHOST SNARE 2 - B","i":{"SN":[2,5,10,13,16]}},{"s":3,"n":"CONTEMPORARY KICK 1 - A","i":{"BD":[1,11],"SN":[5,15]}},{"s":3,"n":"CONTEMPORARY KICK 1 - B","i":{"BD":[3,8,11],"SN":[5,13]}},{"s":3,"n":"CONTEMPORARY KICK 2 - A","i":{"BD":[3,8,11],"SN":[5,10,13]}},{"s":3,"n":"CONTEMPORARY KICK 2 - B","i":{"BD":[3,11,14],"SN":[5,13]}},{"s":3,"n":"CONTEMPORARY KICK 3 - A","i":{"BD":[1,11],"SN":[5,15]}},{"s":3,"n":"CONTEMPORARY KICK 3 - B","i":{"BD":[1,9,11],"SN":[5,13]}},{"s":3,"n":"CONTEMPORARY KICK 4","i":{"BD":[1,9],"SN":[5,11]}},{"s":5,"n":"DRUM ROLL 1","i":{"HT":[9,10,11],"MT":[12,13,14],"LT":[15,16],"OH":[1],"CY":[1]}},{"s":5,"n":"DRUM ROLL 2","i":{"BD":[13,15],"SN":[1,3,4,5,7,9,10,11,12]}},{"s":5,"n":"DRUM ROLL 3","i":{"SN":[1,2,3,5,6,7,9,11,13,14,15,16]}},{"s":5,"n":"DRUM ROLL 4","i":{"BD":[1,7,13],"SN":[4,5,8,9,16],"CY":[1,7,13]}},{"s":5,"n":"DRUM ROLL 5","i":{"HT":[1],"MT":[5,9,11],"LT":[13,15]}},{"s":5,"n":"DRUM ROLL 6","i":{"HT":[1],"MT":[5,9,11],"LT":[13,15]}},{"s":5,"n":"DRUM ROLL 7","i":{"HT":[3],"MT":[4,7,8],"LT":[11,12,14],"SN":[1,5,9,13]}},{"s":5,"n":"DRUM ROLL 8","i":{"HT":[3],"MT":[5,9,11,12],"LT":[15,16],"SN":[1,8,13]}},{"s":5,"n":"DRUM ROLL 9","i":{"HT":[3],"MT":[5,11],"LT":[13,15],"SN":[1,2,7,9,10]}},{"s":5,"n":"DRUM ROLL 10","i":{"HT":[3,4],"MT":[7,8,11,12],"LT":[15,16],"SN":[1,2,5,6,9,10,13,14]}},{"s":5,"n":"DRUM ROLL 11","i":{"HT":[2,14],"MT":[5,8],"LT":[11,15,16],"SN":[1,4,7,10,13],"BD":[3,6,9,12]}},{"s":5,"n":"DRUM ROLL 12","i":{"HT":[3,10],"MT":[11,13],"LT":[12,14,15],"SN":[1,2,9,13],"BD":[5,7],"CY":[5,7]}},{"s":5,"n":"DRUM ROLL 13","i":{"HT":[2],"MT":[6,10],"LT":[14],"SN":[1,5,9,13],"BD":[3,4,7,8,11,12,15,16]}},{"s":5,"n":"DRUM ROLL 14","i":{"HT":[10,11,12,13],"MT":[4,5,6,7,8,9,14,15],"LT":[1,2,3,16]}},{"s":5,"n":"DRUM ROLL 15","i":{"HT":[2,10],"LT":[4,8,12,16],"SN":[1,5,9,13]}},{"s":5,"n":"DRUM ROLL 16","i":{"SN":[1,2,7,8,13,14],"BD":[3,5,11,15],"CH":[3,9,15],"CY":[5,11]}},{"s":5,"n":"DRUM ROLL 17","i":{"HT":[3,4],"MT":[9,10],"SN":[1,2,5,7,8,11,13,14,15,16],"CY":[5,11]}},{"s":5,"n":"DRUM ROLL 18","i":{"SN":[1,7],"BD":[3,5,9,11,15],"CY":[1,7,13]}},{"s":5,"n":"DRUM ROLL 19","i":{"SN":[1,2,7,8,13,14],"BD":[3,5,9,11,15],"CY":[3,5,9,11,15]}},{"s":5,"n":"DRUM ROLL 20","i":{"HT":[3,5],"MT":[7,15],"LT":[16],"SN":[1,9,11,14],"BD":[2,4,6,8,10,12,13],"CY":[9]}}];



function init () {
  println('Drum Pattern ready!')
  const documentState = host.getDocumentState()
  const cursorClipLauncher = host.createLauncherCursorClip(16 * 128, 128)
  const cursorClipArranger = host.createArrangerCursorClip(16 * 128, 128)
  const scrollKey = Math.max(0, 60 + DEFAULT_TRANSPOSE)
  cursorClipLauncher.scrollToKey(scrollKey)
  cursorClipArranger.scrollToKey(scrollKey)

  const names = getPatternNames()
  const patternSetting = documentState.getEnumSetting('Pattern', 'Drum Pattern', names, names[0] || '')
  const clipType = documentState.getEnumSetting('Clip Type', 'Drum Pattern', ['Launcher', 'Arranger'], 'Launcher')
  const velocitySetting = documentState.getNumberSetting('Velocity', 'Drum Pattern', 1, 127, 1, '', DEFAULT_VELOCITY)

  documentState.getSignalSetting('Export', 'Drum Pattern', 'Export Pattern').addSignalObserver(() => {
    const clip = clipType.get() === 'Arranger' ? cursorClipArranger : cursorClipLauncher
    clip.clearSteps()

    const pattern = findPattern(patternSetting.get())
    if (!pattern) {
      const msg = 'Pattern not found: ' + patternSetting.get()
      println(msg)
      host.showPopupNotification(msg)
      return
    }

    writePatternToClip(clip, pattern, velocitySetting.getRaw(), DEFAULT_TRANSPOSE)
    host.showPopupNotification('Exported "' + pattern.n + '" to ' + clipType.get())
  })
}

function getPatternNames () {
  return DRUM_PATTERNS.map(function (p) { return p.n }).sort()
}

function findPattern (name) {
  for (var i = 0; i < DRUM_PATTERNS.length; i++) {
    var p = DRUM_PATTERNS[i]
    if (p.n === name) {
      return p
    }
  }
  return null
}

function writePatternToClip (cursorClip, pattern, velocity, transpose) {
  var instruments = pattern.i || {}
  var longestStep = 0

  for (var code in instruments) {
    if (!instruments.hasOwnProperty(code)) continue
    var midiNote = GM_DRUM_MAP[code]
    if (midiNote === undefined) {
      println('Unknown drum code: ' + code)
      continue
    }
    midiNote = midiNote + transpose
    while (midiNote < 0) {
      midiNote += 12
    }
    while (midiNote > 127) {
      midiNote -= 12
    }
    var steps = instruments[code]
    for (var i = 0; i < steps.length; i++) {
      var stepNumber = steps[i]
      var stepIndex = Math.max(0, stepNumber - 1)
      var timeIn16ths = stepIndex
      cursorClip.setStep(0, timeIn16ths, midiNote, velocity, STEP_LENGTH_BEATS)
      if (stepNumber > longestStep) {
        longestStep = stepNumber
      }
    }
  }

  var clipLengthInBeats = Math.max(4, longestStep * STEP_LENGTH_BEATS)
  try {
    if (typeof cursorClip.setLength === 'function') {
      cursorClip.setLength(clipLengthInBeats)
    } else if (cursorClip.getLength && typeof cursorClip.getLength().set === 'function') {
      cursorClip.getLength().set(clipLengthInBeats)
    }
  } catch (e) {
    // Length APIs may vary across Bitwig versions; ignore if unavailable.
  }
}

function flush () {}
function exit () {
  println('-- Drum Pattern Bye! --')
}
